ISSUE: We have two problems to solve:
1. A 404 error when clicking "Open in Editor" from the gallery because the route in `App.tsx` doesn't accept an `imageId`.
2. Existing images are not displayed in the gallery because their `project_id` is `null`.

GOAL: Fix both issues in one go. First, correct the routing problem. Second, create and execute a one-time data migration script to associate old images with projects.

STRATEGY: This will be a 3-step process:
1.  **Fix Routing**: Update `App.tsx` and `EditorPage.jsx` to handle parameterized routes.
2.  **Add Migration Logic**: Implement a temporary `POST /api/migrate-data` endpoint and the necessary database methods.
3.  **Execute & Clean Up**: Run the migration and then remove the temporary code.

Use the following reference code snippets to perform the required updates.

═══════════════════════════════════════════════════════════════════════
IMPLEMENTATION INSTRUCTIONS:
═══════════════════════════════════════════════════════════════════════

**TASK 1: FIX THE 404 ROUTING BUG**

1.  **UPDATE `client/src/App.tsx`**: Modify the `<Route>` for the editor to accept an `imageId` parameter.
    
    **FROM:**
    `<Route path="/editor" element={<EditorPage />} />`
    
    **TO:**
    `<Route path="/editor/:imageId" element={<EditorPage />} />`

2.  **UPDATE `client/src/pages/EditorPage.jsx`**: Update the component to retrieve the `imageId` from the URL parameters. This ensures the correct session is loaded.

    ```javascript
    // At the top of EditorPage.jsx, with other imports
    import { useParams } from 'react-router-dom';
    
    // Inside the EditorPage component function
    const { imageId } = useParams();
    
    // In your useEffect hook for loading the session, ensure you use this `imageId`.
    useEffect(() => {
      if (imageId) {
        console.log(`Restoring session for imageId from URL: ${imageId}`);
        // Your existing session restoration logic should now use this ID.
      }
    }, [imageId]);
    ```

**TASK 2: ADD DATA MIGRATION LOGIC**

1.  **UPDATE `server/storage.ts`**: Add the following new methods to the `Storage` class to support the migration.

    ```typescript
    async getAllImagesAndEdits() {
      const images = await this.pool.query('SELECT * FROM images WHERE project_id IS NULL');
      const edits = await this.pool.query('SELECT * FROM edits');
      return { images: images.rows, edits: edits.rows };
    }
    
    async updateImageProjectId(imageId: number, projectId: number) {
      await this.pool.query('UPDATE images SET project_id = $1 WHERE id = $2', [projectId, imageId]);
    }
    ```

2.  **UPDATE `server/routes.ts`**: Add the new, temporary `POST /api/migrate-data` endpoint.

    ```typescript
    app.post('/api/migrate-data', async (req, res) => {
      try {
        const userId = req.headers['x-replit-user-id'];
        if (!userId) return res.status(401).send('Unauthorized');
    
        const { images, edits } = await storage.getAllImagesAndEdits();
        const editedImageUrls = new Set(edits.map(e => e.edited_image_url));
    
        const originalImages = images.filter(img => !editedImageUrls.has(img.url));
    
        let projectsCreated = 0;
        let imagesLinked = 0;
    
        for (const originalImg of originalImages) {
          const newProject = await storage.createProject(userId, `Migrated Project - ${originalImg.id}`);
          projectsCreated++;
    
          await storage.updateImageProjectId(originalImg.id, newProject.id);
          imagesLinked++;
    
          const relatedEdits = edits.filter(e => e.original_image_id === originalImg.id);
          for (const edit of relatedEdits) {
            const editImageRecord = images.find(i => i.url === edit.edited_image_url);
            if (editImageRecord) {
              await storage.updateImageProjectId(editImageRecord.id, newProject.id);
              imagesLinked++;
            }
          }
        }
    
        res.status(200).json({ 
          message: 'Migration successful!',
          projectsCreated,
          imagesLinked,
        });

      } catch (error) {
        console.error('Migration failed:', error);
        res.status(500).send('Migration failed');
      }
    });
    ```

**TASK 3: EXECUTE MIGRATION & CLEAN UP**

1.  **EXECUTE**: After the code is updated, run the migration by sending a POST request from the Shell.
    ```bash
    curl -X POST http://localhost:3000/api/migrate-data
    ```

2.  **VERIFY**: Check the gallery. Your old projects should now appear correctly.

3.  **CLEAN UP**: After successful verification, instruct me to remove the temporary migration code. Say: "Migration complete, please clean up the code."